<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rebel Datapad Codex â€” Test (GM Enabled)</title>
<style>
/* ====== CORE STYLING ====== */
* { box-sizing:border-box; margin:0; padding:0; font-family:'OCR A Std','Courier New', monospace; }
body {
  background: radial-gradient(ellipse at center, #050505 0%, #000 100%);
  color:#a0d8ff;
  height:100vh; display:flex; justify-content:center; align-items:center;
  overflow:hidden;
}
#datapad {
  width:900px; height:600px;
  background: url('images/metal_texture.jpg') center/cover no-repeat;
  border:6px solid #333;
  border-radius:25px;
  position:relative;
  box-shadow: 0 0 60px rgba(0,255,255,0.05), inset 0 0 20px #000;
  overflow:hidden;
}
#datapad::before {
  content:"";
  position:absolute; inset:0;
  border-radius:25px;
  background: url('images/metal_noise.png') repeat;
  opacity:0.18;
  z-index:0;
}

/* ====== SCREEN & EFFECTS ====== */
#screen {
  position:absolute;
  top:40px; left:40px;
  width:820px; height:520px;
  background:radial-gradient(circle at 50% 50%, rgba(10,20,25,0.96) 0%, rgba(5,10,12,0.92) 100%);
  border-radius:15px;
  overflow:hidden;
  box-shadow: inset 0 0 20px rgba(0,255,255,0.18);
  z-index:1;
  animation: glowPulse 3s infinite alternate;
}
@keyframes glowPulse {
  0% { box-shadow: inset 0 0 20px rgba(0,255,255,0.12); }
  50% { box-shadow: inset 0 0 35px rgba(0,255,255,0.26); }
  100% { box-shadow: inset 0 0 25px rgba(0,255,255,0.16); }
}

#flicker,
#distortion,
#blueBase,
#dotFlicker,
#cursor-dot {
  pointer-events: none !important;
}

#flicker { position:absolute; inset:0; background: repeating-linear-gradient(0deg, rgba(0,255,255,0.12) 0px, rgba(0,255,255,0.12) 1px, transparent 2px, transparent 3px); z-index:6; opacity:0; }
#screen::before { content:""; position:absolute; inset:0; pointer-events:none; background: repeating-linear-gradient(to bottom, rgba(0,255,255,0.03) 0px, rgba(0,255,255,0.03) 1px, transparent 2px, transparent 3px); animation: scanlines 1s linear infinite; z-index:7; }
@keyframes scanlines { 0% { background-position: 0 0; } 100% { background-position: 0 4px; } }

#distortion { position:absolute; inset:0; background: radial-gradient(circle at var(--x,50%) var(--y,50%), rgba(0,255,255,0.18) 0%, transparent 40%); z-index:5; }
#blueBase { position:absolute; inset:0; background-color: rgba(0,255,255,0.18); z-index:1; mix-blend-mode: screen; }
#blueBase::after { content: ""; position: absolute; inset: 0; background: repeating-linear-gradient(0deg, rgba(0,255,255,0.04) 0px, rgba(0,255,255,0.04) 1px, transparent 2px, transparent 3px); opacity: 0.25; animation: staticNoise 0.2s steps(2) infinite; z-index:2; }
@keyframes staticNoise { 0% { background-position: 0 0; } 100% { background-position: 0 100%; } }

/* ====== MAIN CONTENT ====== */
#content {
  display:flex;
  height:100%;
  position:relative;
  z-index:10; /* ensures sidebar is clickable */
}

#sidebar {
  width:200px;
  background:rgba(5,15,20,0.84);
  border-right:1px solid #033;
  display:flex;
  flex-direction:column;
  padding:15px;
  gap:8px;
}
#sidebar h2 { color:#33cfff; text-align:center; margin-bottom:6px; }

.category-btn {
  background:#0a1f26;
  border:none;
  padding:8px;
  color:#33cfff;
  text-align:left;
  border-left:4px solid #0a5266;
  cursor:pointer;
  border-radius:6px;
}
.category-btn:hover { background:#0e2a34; border-left-color:#66f0ff; }
.category-btn.active { border-left-color:#00ffff; background:#0e2a34; }

#search {
  margin-top:auto;
  padding:8px;
  background:#07131a;
  border:1px solid #113844;
  color:#a0d8ff;
  border-radius:6px;
  outline:none;
}

#main { flex:1; padding:18px; overflow-y:auto; position:relative; }
#breadcrumbs { margin-bottom:12px; font-size:14px; color:#33cfff; display:flex; gap:8px; align-items:center; }
#breadcrumbs span { cursor:pointer; text-decoration:underline; }

#entryContent h1 { font-size:22px; margin-bottom:10px; color:#66f0ff; }
#entryContent img { display:block; margin:10px auto; max-width:100%; max-height:320px; border:2px solid #33cfff; border-radius:6px; box-shadow:0 0 18px rgba(0,255,255,0.2); }
#entryContent p { font-size:15px; line-height:1.6em; white-space:pre-wrap; color:#dff6ff; }

/* Entry buttons */
.entry-row { display:flex; align-items:center; gap:8px; margin:8px 0; }
.entry-title {
  flex:1; background:#081a20; border:none; padding:8px; color:#a0d8ff;
  text-align:left; cursor:pointer;
  border-left:6px solid #0a5266; border-radius:6px; font-size:15px;
}
.entry-title.locked { border-left-color:#777; color:#777; }
.entry-title.gm-locked { border-left-color:#ffcc33; color:#ffffcc; }
.entry-title.unlocked { border-left-color:#0f0; color:#bfffdc; }

.unlock-btn { padding:6px 10px; border:none; border-radius:6px; cursor:pointer; background:#003; color:#66ffff; }
.unlock-btn.remove { background:#700; color:#ffc; }

/* GM indicator + lights */
#gmIndicator {
  position:absolute; top:12px; left:20px;
  background: rgba(0,0,0,0.55);
  color:#66ffff; font-size:12px; font-weight:700;
  padding:6px 10px; border-radius:6px; z-index:8;
  pointer-events:none; opacity:0; transition:opacity .16s;
}
#gmIndicator.active { opacity:1; }

.corner-lights { position:absolute; top:12px; right:12px; display:flex; gap:8px; z-index:9; pointer-events:none; }
.corner { width:12px; height:12px; border-radius:50%; box-shadow: 0 0 8px rgba(255,255,255,0.03); }
.corner.tl { position:absolute; top:12px; left:12px; background:#00aaff; box-shadow:0 0 8px #00aaff; }
.corner.tr { background:#ff4444; box-shadow:0 0 8px #ff4444; right:12px; top:12px; position:absolute; }
.corner.bl { position:absolute; bottom:12px; left:12px; background:#9a00ff; box-shadow:0 0 8px #9a00ff; }
.corner.br { position:absolute; bottom:12px; right:12px; background:#ff8c00; box-shadow:0 0 8px #ff8c00; }

#syncInfo {
  position:absolute; right:18px; top:36px; z-index:9; color:#bfeffb; font-size:12px; opacity:0.9;
  text-shadow: 0 0 4px rgba(0,0,0,0.6);
}

#cursor-dot { position:absolute; width:12px; height:12px; border-radius:50%; background:#0ff; transform:translate(-50%,-50%); z-index:12; pointer-events:none; }

/* Scrollbar style */
#main::-webkit-scrollbar { width:10px; }
#main::-webkit-scrollbar-thumb { background:#0a5266; border-radius:6px; }
#main::-webkit-scrollbar-track { background:#02111a; border-radius:6px; }
</style>
</head>
<body>
<div id="datapad">
  <div id="blueBase"></div>
  <div id="distortion"></div>
  <div id="flicker"></div>
  <div id="screen">
    <div id="content">
      <div id="sidebar">
        <h2>Categories</h2>
        <button class="category-btn" data-category="planets">Planets</button>
        <button class="category-btn" data-category="characters">Characters</button>
        <button class="category-btn" data-category="technology">Technology</button>
        <button class="category-btn" data-category="items">Items</button>
        <button class="category-btn" data-category="factions">Factions</button>
        <button class="category-btn" data-category="missions">Missions</button>
        <input type="text" id="search" placeholder="Search..." />
      </div>
      <div id="main">
        <div id="breadcrumbs"></div>
        <div id="entryContent">
          <p>Select a category to begin.</p>
        </div>
      </div>
    </div>
    <div id="gmIndicator">GM MODE</div>
    <div class="corner-lights">
      <div class="corner tl"></div>
      <div class="corner tr"></div>
      <div class="corner bl"></div>
      <div class="corner br"></div>
    </div>
    <div id="syncInfo">Sync: local</div>
  </div>
  <div id="cursor-dot"></div>
</div>

<script>
// ===== GLOBAL VARIABLES =====
let entries = {};
let unlockedEntries = {};
let currentCategory = null;

// ===== GM MODE =====
let gmMode = false;

// ===== CURSOR EFFECT =====
document.addEventListener("mousemove", e => {
  const dot = document.getElementById("cursor-dot");
  dot.style.left = e.clientX + "px";
  dot.style.top = e.clientY + "px";
  document.getElementById("distortion").style.setProperty("--x", (e.clientX/window.innerWidth)*100 + "%");
  document.getElementById("distortion").style.setProperty("--y", (e.clientY/window.innerHeight)*100 + "%");
});

// ===== CATEGORY BUTTONS =====
const catBtns = document.querySelectorAll(".category-btn");
catBtns.forEach(btn => {
  btn.addEventListener("click", () => {
    catBtns.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    currentCategory = btn.dataset.category;
    renderEntries();
  });
});

// ===== SEARCH FUNCTION =====
document.getElementById("search").addEventListener("input", e => {
  renderEntries(e.target.value);
});

// ===== RENDER ENTRIES =====
function renderEntries(search="") {
  const container = document.getElementById("entryContent");
  container.innerHTML = "";
  if(!currentCategory || !entries[currentCategory]) return;
  const filtered = entries[currentCategory].filter(en=>{
    const unlocked = unlockedEntries[en.id] || en.unlocked;
    const matchSearch = en.name.toLowerCase().includes(search.toLowerCase());
    return matchSearch && (gmMode || unlocked);
  });
  if(filtered.length===0){ container.innerHTML="<p>No entries found.</p>"; return; }
  filtered.forEach(en=>{
    const row = document.createElement("div");
    row.className="entry-row";
    const btn = document.createElement("button");
    btn.className="entry-title "+(unlockedEntries[en.id]?"unlocked":"locked");
    btn.textContent=en.name;
    btn.addEventListener("click", ()=>displayEntry(en));
    row.appendChild(btn);

    if(gmMode){
      const unlockBtn = document.createElement("button");
      unlockBtn.className="unlock-btn";
      unlockBtn.textContent = unlockedEntries[en.id]?"Remove":"Unlock";
      unlockBtn.addEventListener("click", e=>{
        e.stopPropagation();
        if(unlockedEntries[en.id]){
          delete unlockedEntries[en.id];
        } else {
          unlockedEntries[en.id]=true;
        }
        renderEntries(document.getElementById("search").value);
      });
      row.appendChild(unlockBtn);
    }

    container.appendChild(row);
  });
}

// ===== DISPLAY ENTRY =====
function displayEntry(en){
  const container = document.getElementById("entryContent");
  let html = `<h1>${en.name}</h1>`;
  if(en.img) html += `<img src="${en.img}" />`;
  if(en.desc) html += `<p>${en.desc}</p>`;
  container.innerHTML = html;

  updateBreadcrumbs(en);
}

// ===== BREADCRUMBS =====
function updateBreadcrumbs(en){
  const bc = document.getElementById("breadcrumbs");
  bc.innerHTML="";
  if(currentCategory){
    const catSpan = document.createElement("span");
    catSpan.textContent = currentCategory.charAt(0).toUpperCase()+currentCategory.slice(1);
    catSpan.addEventListener("click", ()=>renderEntries());
    bc.appendChild(catSpan);
    bc.appendChild(document.createTextNode(" > "));
  }
  const enSpan = document.createElement("span");
  enSpan.textContent = en.name;
  bc.appendChild(enSpan);
}

// ===== LOAD ENTRIES FROM JSON =====
async function loadAllEntries(){
  const manifestResp = await fetch('manifest.json');
  const manifest = await manifestResp.json();
  for(const file of manifest){
    const res = await fetch('entries/'+file);
    const data = await res.json();
    for(const cat in data){
      if(!entries[cat]) entries[cat]=[];
      entries[cat] = entries[cat].concat(data[cat]);
    }
  }
  renderEntries();
}

// ===== INITIALIZE =====
loadAllEntries();
</script>
</body>
</html>
