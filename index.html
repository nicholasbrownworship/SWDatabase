<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Rebel Datapad Entries</title>
<style>
* { box-sizing:border-box; margin:0; padding:0; font-family:'OCR A Std','Courier New', monospace; }
body {
  background: radial-gradient(ellipse at center, #050505 0%, #000 100%);
  color:#a0d8ff;
  height:100vh; display:flex; justify-content:center; align-items:center;
  overflow:hidden;
  cursor:none;
}
#datapad {
  width:900px; height:600px;
  background: url('images/metal_texture.jpg') center/cover no-repeat;
  border:6px solid #333;
  border-radius:25px;
  position:relative;
  box-shadow: 0 0 60px rgba(0,255,255,0.05), inset 0 0 20px #000;
  overflow:hidden;
}
#datapad::before {
  content:"";
  position:absolute; inset:0;
  border-radius:25px;
  background: url('images/metal_noise.png') repeat;
  opacity:0.2;
  z-index:0;
}
#screen {
  position:absolute;
  top:40px; left:40px;
  width:820px; height:520px;
  background:radial-gradient(circle at 50% 50%, rgba(10,20,25,0.95) 0%, rgba(5,10,12,0.9) 100%);
  border-radius:15px;
  overflow:hidden;
  box-shadow: inset 0 0 20px rgba(0,255,255,0.2);
  z-index:1;
  animation: glowPulse 3s infinite alternate;
  cursor:none;
}
#screen * { cursor:none; }
@keyframes glowPulse {
  0% { box-shadow: inset 0 0 20px rgba(0,255,255,0.15); }
  50% { box-shadow: inset 0 0 35px rgba(0,255,255,0.3); }
  100% { box-shadow: inset 0 0 25px rgba(0,255,255,0.2); }
}
#flicker {
  position:absolute; inset:0;
  background: repeating-linear-gradient(0deg, rgba(0,255,255,0.15) 0px, rgba(0,255,255,0.15) 1px, transparent 2px, transparent 3px);
  pointer-events:none;
  z-index:6;
  opacity:0;
}
#screen::before {
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background: repeating-linear-gradient(
    to bottom,
    rgba(0,255,255,0.03) 0px,
    rgba(0,255,255,0.03) 1px,
    transparent 2px,
    transparent 3px
  );
  animation: scanlines 1s linear infinite;
  z-index:7;
}
@keyframes scanlines {
  0% { background-position: 0 0; }
  100% { background-position: 0 4px; }
}
#distortion {
  position:absolute;
  inset:0;
  background: radial-gradient(circle at var(--x) var(--y), rgba(0,255,255,0.25) 0%, transparent 50%);
  pointer-events:none;
  z-index:5;
}
#blueBase {
  position:absolute;
  inset:0;
  background-color: rgba(0,255,255,0.35);
  pointer-events:none; 
  z-index:1;
  mix-blend-mode: screen;
}
#content { display:flex; height:100%; position:relative; z-index:0; }
#sidebar {
  width:200px; background:rgba(5,15,20,0.8); border-right:1px solid #033;
  display:flex; flex-direction:column; padding:15px;
  z-index:2;
}
#sidebar h2 { color:#33cfff; text-align:center; margin-bottom:10px; }
.category-btn {
  background:#0a1f26; border:none; margin:4px 0; padding:8px; color:#33cfff;
  cursor:pointer; text-align:left; border-left:4px solid #0a5266;
  transition: all 0.2s;
}
.category-btn:hover { background:#0e2a34; border-left-color:#66f0ff; }
.category-btn.active { border-left-color:#00ffff; background:#0e2a34; }
#search { margin-top:auto; padding:6px; background:#0b1c23; border:1px solid #33cfff; color:#a0d8ff; }
#main { flex:1; padding:20px; overflow-y:auto; position:relative; z-index:0; }
#breadcrumbs { margin-bottom:10px; font-size:14px; color:#33cfff; }
#breadcrumbs span { cursor: default; }
#breadcrumbs span:hover { text-decoration: underline; }
#entryContent h1 { font-size:22px; margin-bottom:10px; color:#66f0ff; position:relative; z-index:0; }
#entryContent img {
  display:block; margin:10px auto; max-width:100%; max-height:300px;
  border:2px solid #33cfff; border-radius:4px;
  box-shadow:0 0 15px rgba(0,255,255,0.3);
  position:relative; z-index:0;
}
#entryContent p { font-size:15px; line-height:1.5em; position:relative; z-index:0; }
.indicator {
  position:absolute; width:12px; height:12px; border-radius:50%;
  background:#0f0; box-shadow:0 0 8px #0f0;
}
.indicator.red { background:#f00; box-shadow:0 0 8px #f00; }
.indicator:nth-child(1){ top:10px; left:10px; }
.indicator:nth-child(2){ top:10px; right:10px; }
.indicator:nth-child(3){ bottom:10px; left:10px; }
.indicator:nth-child(4){ bottom:10px; right:10px; }
#cursor-dot {
  position:absolute;
  width:12px; height:12px;
  border-radius:50%;
  background: rgba(0,255,255,0.8);
  box-shadow:0 0 8px rgba(0,255,255,0.8), 0 0 15px rgba(0,255,255,0.5);
  pointer-events:none;
  transform: translate(-50%, -50%);
  z-index:3;
}
/* Animated static overlay on #blueBase */
#blueBase::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: 
    repeating-linear-gradient(
      0deg, 
      rgba(0,255,255,0.05) 0px, 
      rgba(0,255,255,0.05) 1px, 
      transparent 2px, 
      transparent 3px
    );
  opacity: 0.3;
  animation: staticNoise 0.2s steps(2) infinite;
  z-index:2;
}
@keyframes staticNoise {
  0% { background-position: 0 0; }
  100% { background-position: 0 100%; }
}
#dotFlicker {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 4;
}
.dot {
  position: absolute;
  width: 2px;
  height: 2px;
  border-radius: 50%;
  background: rgba(0,255,255,0.6);
  box-shadow: 0 0 4px rgba(0,255,255,0.8);
  pointer-events: none;
}
</style>
</head>
<body>
<div id="datapad">
  <div class="indicator"></div>
  <div class="indicator red"></div>
  <div class="indicator red"></div>
  <div class="indicator"></div>

  <div id="screen">
    <div id="flicker"></div>
    <div id="distortion"></div>

    <div id="content">
      <div id="sidebar">
        <h2>Codex</h2>
        <button id="homeBtn" class="category-btn">Home</button>
        <button class="category-btn" data-category="planets">Planets</button>
        <button class="category-btn" data-category="factions">Factions</button>
        <button class="category-btn" data-category="technology">Technology</button>
        <button class="category-btn" data-category="characters">Characters</button>
        <input type="text" id="search" placeholder="Search...">
      </div>
      <div id="main">
        <div id="breadcrumbs"></div>
        <div id="entryContent">
          <h1>Rebel Alliance Field Entries</h1>
          <p>Loading entries... Select a category on the left to access the database.</p>
        </div>
        <div id="blueBase"></div>
      </div>
    </div>
    <div id="dotFlicker"></div>
    <div id="cursor-dot"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const entryContent = document.getElementById('entryContent');
  const breadcrumbs = document.getElementById('breadcrumbs');
  const categoryBtns = document.querySelectorAll('.category-btn');
  const searchInput = document.getElementById('search');
  const homeBtn = document.getElementById('homeBtn');
  const flicker = document.getElementById('flicker');
  const distortion = document.getElementById('distortion');
  const screen = document.getElementById('screen');
  const cursorDot = document.getElementById('cursor-dot');
  const dotFlicker = document.getElementById('dotFlicker');

  let activeCategory = null;
  let activeSubFile = null;
  let entriesData = [];
  let isGM = false;

  // GM Mode toggle
  document.addEventListener('keydown', e => {
    if(e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'g') {
      isGM = !isGM;
      console.log("GM Mode:", isGM);
      renderEntries(entriesData);
    }
  });

  async function loadCategoryEntries(category) {
    const manifestPath = `entries/${category}/manifest.json`;
    let entryList = [];
    try {
      const manifestResponse = await fetch(manifestPath);
      if (!manifestResponse.ok) throw new Error(`Could not fetch manifest for ${category}`);
      const files = await manifestResponse.json();
      for (const file of files) {
        const entryResponse = await fetch(`entries/${category}/${file}`);
        if (!entryResponse.ok) continue;
        const entryData = await entryResponse.json();
        const unlocked = entryData.gmMode ? localStorage.getItem(entryData.id) === "true" : true;
        if (unlocked || isGM) entryList.push(entryData);
      }
      entriesData = entryList;
      return entryList;
    } catch (error) {
      console.error(error);
      return [];
    }
  }

  function updateBreadcrumbs() {
    breadcrumbs.innerHTML = '';
    if(activeCategory) {
      const catSpan = document.createElement('span');
      catSpan.textContent = activeCategory.charAt(0).toUpperCase() + activeCategory.slice(1);
      catSpan.style.cursor = 'pointer';
      catSpan.addEventListener('click', () => {
        activeSubFile = null;
        renderEntries(entriesData);
      });
      breadcrumbs.appendChild(catSpan);

      if(activeSubFile) {
        const sep = document.createElement('span');
        sep.textContent = ' > ';
        breadcrumbs.appendChild(sep);

        const subSpan = document.createElement('span');
        subSpan.textContent = activeSubFile.name;
        breadcrumbs.appendChild(subSpan);
      }
    }
  }

  function renderEntries(entries) {
    updateBreadcrumbs();
    entryContent.innerHTML = '';
    if(!activeSubFile){
      entries.forEach(entry => {
        const btn = document.createElement('button');
        btn.textContent = entry.name;
        btn.classList.add('category-btn');
        btn.style.margin = '6px 0';
        const unlocked = entry.gmMode ? localStorage.getItem(entry.id) === "true" : true;
        btn.style.color = unlocked ? "#33cfff" : (isGM ? "#ffff66" : "#555");
        btn.addEventListener('click', () => {
          activeSubFile = entry;
          renderEntryDetail(entry);
        });
        entryContent.appendChild(btn);
        if(isGM && entry.gmMode){
          const removeBtn = document.createElement('button');
          removeBtn.textContent = unlocked ? "Lock" : "Unlock";
          removeBtn.style.marginLeft = "5px";
          removeBtn.style.background="#222";
          removeBtn.style.color="#ff0";
          removeBtn.addEventListener('click', e=>{
            e.stopPropagation();
            if(localStorage.getItem(entry.id) === "true") localStorage.removeItem(entry.id);
            else localStorage.setItem(entry.id,"true");
            renderEntries(entries);
          });
          btn.appendChild(removeBtn);
        }
      });
    } else {
      renderEntryDetail(activeSubFile);
    }
  }

  function renderEntryDetail(entry){
    updateBreadcrumbs();
    entryContent.innerHTML = `<h1>${entry.name}</h1>
                              <img src="${entry.image}" alt="${entry.name}">
                              <p>${entry.description}</p>`;
    if(isGM && entry.gmMode){
      const removeBtn = document.createElement('button');
      removeBtn.textContent = localStorage.getItem(entry.id) === "true" ? "Lock" : "Unlock";
      removeBtn.classList.add('category-btn');
      removeBtn.style.marginTop='10px';
      removeBtn.addEventListener('click', ()=>{
        if(localStorage.getItem(entry.id) === "true") localStorage.removeItem(entry.id);
        else localStorage.setItem(entry.id,"true");
        renderEntries(entriesData);
      });
      entryContent.appendChild(removeBtn);
    }
    const backBtn = document.createElement('button');
    backBtn.textContent = 'Back';
    backBtn.classList.add('category-btn');
    backBtn.style.marginTop='10px';
    backBtn.addEventListener('click', ()=>{
      activeSubFile=null;
      renderEntries(entriesData);
    });
    entryContent.appendChild(backBtn);
  }

  categoryBtns.forEach(btn => {
    if(btn.id === "homeBtn") return;
    btn.addEventListener('click', async ()=>{
      categoryBtns.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      activeCategory = btn.dataset.category;
      activeSubFile=null;
      const entries = await loadCategoryEntries(activeCategory);
      renderEntries(entries);
    });
  });

  homeBtn.addEventListener('click', ()=>{
    activeCategory=null;
    activeSubFile=null;
    breadcrumbs.innerHTML='';
    entryContent.innerHTML=`<h1>Rebel Alliance Field Entries</h1>
                            <p>Loading entries... Select a category on the left to access the database.</p>`;
    categoryBtns.forEach(b=>b.classList.remove('active'));
  });

  // Flicker
  function randomFlicker() {
    if(Math.random() < 0.4){
      flicker.style.opacity = (0.1 + Math.random() * 0.3).toFixed(2);
      setTimeout(()=>{ flicker.style.opacity = 0; }, 50 + Math.random()*150);
    }
  }
  setInterval(randomFlicker, 80);

  // Distortion
  function randomDistortion() {
    if(Math.random() < 0.05) {
      const xShift = (Math.random()*8-4).toFixed(1);
      const yShift = (Math.random()*8-4).toFixed(1);
      distortion.style.transform = `translate(${xShift}px, ${yShift}px)`;
      setTimeout(()=>{ distortion.style.transform = 'translate(0,0)'; }, 50 + Math.random()*50);
    }
  }
  setInterval(randomDistortion, 100);

  // Cursor tracking inside screen
  screen.addEventListener('mousemove', e=>{
    const rect = screen.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    cursorDot.style.left = x + 'px';
    cursorDot.style.top = y + 'px';
  });

  // Dot flicker overlay
  function createRandomDot() {
    const dot = document.createElement('div');
    dot.classList.add('dot');
    dot.style.left = Math.random()*100+'%';
    dot.style.top = Math.random()*100+'%';
    dotFlicker.appendChild(dot);
    setTimeout(()=>dot.remove(), 100+Math.random()*200);
  }
  setInterval(()=>{ if(Math.random()<0.3) createRandomDot(); }, 50);

});
</script>
</body>
</html>
