<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Rebel Datapad Codex</title>
<style>
* { box-sizing:border-box; margin:0; padding:0; font-family:'OCR A Std','Courier New', monospace; }
body {
  background: radial-gradient(ellipse at center, #050505 0%, #000 100%);
  color:#a0d8ff;
  height:100vh; display:flex; justify-content:center; align-items:center;
  overflow:hidden;
  cursor:none;
}
#datapad {
  width:900px; height:600px;
  background: url('images/metal_texture.jpg') center/cover no-repeat;
  border:6px solid #333;
  border-radius:25px;
  position:relative;
  box-shadow: 0 0 60px rgba(0,255,255,0.05), inset 0 0 20px #000;
  overflow:hidden;
}
#datapad::before {
  content:"";
  position:absolute; inset:0;
  border-radius:25px;
  background: url('images/metal_noise.png') repeat;
  opacity:0.2;
  z-index:0;
}
#screen {
  position:absolute;
  top:40px; left:40px;
  width:820px; height:520px;
  background:radial-gradient(circle at 50% 50%, rgba(10,20,25,0.95) 0%, rgba(5,10,12,0.9) 100%);
  border-radius:15px;
  overflow:hidden;
  box-shadow: inset 0 0 20px rgba(0,255,255,0.2);
  z-index:1;
  animation: glowPulse 3s infinite alternate;
  cursor:none;
}
#screen * { cursor:none; }
@keyframes glowPulse {
  0% { box-shadow: inset 0 0 20px rgba(0,255,255,0.15); }
  50% { box-shadow: inset 0 0 35px rgba(0,255,255,0.3); }
  100% { box-shadow: inset 0 0 25px rgba(0,255,255,0.2); }
}
#flicker {
  position:absolute; inset:0;
  background: repeating-linear-gradient(0deg, rgba(0,255,255,0.15) 0px, rgba(0,255,255,0.15) 1px, transparent 2px, transparent 3px);
  pointer-events:none;
  z-index:6;
  opacity:0;
}
#screen::before {
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background: repeating-linear-gradient(
    to bottom,
    rgba(0,255,255,0.03) 0px,
    rgba(0,255,255,0.03) 1px,
    transparent 2px,
    transparent 3px
  );
  animation: scanlines 1s linear infinite;
  z-index:7;
}
@keyframes scanlines {
  0% { background-position: 0 0; }
  100% { background-position: 0 4px; }
}
#distortion {
  position:absolute;
  inset:0;
  background: radial-gradient(circle at var(--x) var(--y), rgba(0,255,255,0.25) 0%, transparent 50%);
  pointer-events:none;
  z-index:5;
}
#blueBase {
  position:absolute;
  inset:0;
  background-color: rgba(0,255,255,0.35);
  pointer-events:none; 
  z-index:1; 
  mix-blend-mode: screen;
}
#blueBase::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: repeating-linear-gradient(
      0deg, 
      rgba(0,255,255,0.05) 0px, 
      rgba(0,255,255,0.05) 1px, 
      transparent 2px, 
      transparent 3px
  );
  opacity: 0.3;
  animation: staticNoise 0.2s steps(2) infinite;
  z-index:2; 
}
@keyframes staticNoise {
  0% { background-position: 0 0; }
  100% { background-position: 0 100%; }
}
#content { display:flex; height:100%; position:relative; z-index:0; }
#sidebar {
  width:200px; background:rgba(5,15,20,0.8); border-right:1px solid #033;
  display:flex; flex-direction:column; padding:15px;
  z-index:2; 
}
#sidebar h2 { color:#33cfff; text-align:center; margin-bottom:10px; }
.category-btn {
  background:#0a1f26; border:none; margin:4px 0; padding:8px; color:#33cfff;
  cursor:pointer; text-align:left; border-left:4px solid #0a5266;
  transition: all 0.2s;
}
.category-btn:hover { background:#0e2a34; border-left-color:#66f0ff; }
.category-btn.active { border-left-color:#00ffff; background:#0e2a34; }
#search { margin-top:auto; padding:6px; background:#0b1c23; border:1px solid #33cfff; color:#a0d8ff; }
#main { flex:1; padding:20px; overflow-y:auto; position:relative; z-index:0; }
#breadcrumbs { margin-bottom:10px; font-size:14px; color:#33cfff; }
#breadcrumbs span { cursor: default; }
#breadcrumbs span:hover { text-decoration: underline; }
#entryContent h1 { font-size:22px; margin-bottom:10px; color:#66f0ff; position:relative; z-index:0; }
#entryContent img {
  display:block; margin:10px auto; max-width:100%; max-height:300px;
  border:2px solid #33cfff; border-radius:4px;
  box-shadow:0 0 15px rgba(0,255,255,0.3);
  position:relative; z-index:0;
}
#entryContent p { font-size:15px; line-height:1.5em; position:relative; z-index:0; }
.indicator {
  position:absolute; width:12px; height:12px; border-radius:50%;
  background:#0f0; box-shadow:0 0 8px #0f0;
}
.indicator.red { background:#f00; box-shadow:0 0 8px #f00; }
.indicator:nth-child(1){ top:10px; left:10px; }
.indicator:nth-child(2){ top:10px; right:10px; }
.indicator:nth-child(3){ bottom:10px; left:10px; }
.indicator:nth-child(4){ bottom:10px; right:10px; }
#cursor-dot {
  position:absolute;
  width:12px; height:12px;
  border-radius:50%;
  background: rgba(0,255,255,0.8);
  box-shadow:0 0 8px rgba(0,255,255,0.8), 0 0 15px rgba(0,255,255,0.5);
  pointer-events:none;
  transform: translate(-50%, -50%);
  z-index:3;
}
#dotFlicker {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 4; 
}
.dot {
  position: absolute;
  width: 2px;
  height: 2px;
  border-radius: 50%;
  background: rgba(0,255,255,0.6);
  box-shadow: 0 0 4px rgba(0,255,255,0.8);
  pointer-events: none;
}
</style>
</head>
<body>
<div id="datapad">
  <div class="indicator"></div>
  <div class="indicator red"></div>
  <div class="indicator red"></div>
  <div class="indicator"></div>

  <div id="screen">
    <div id="flicker"></div>
    <div id="distortion"></div>

    <div id="content">
      <div id="sidebar">
        <h2>Codex</h2>
        <button id="homeBtn" class="category-btn">Home</button>
        <button class="category-btn" data-category="planets">Planets</button>
        <button class="category-btn" data-category="factions">Factions</button>
        <button class="category-btn" data-category="technology">Technology</button>
        <button class="category-btn" data-category="characters">Characters</button>
        <input type="text" id="search" placeholder="Search...">
      </div>
      <div id="main">
        <div id="breadcrumbs"></div>
        <div id="entryContent">
          <h1>Rebel Alliance Field Codex</h1>
          <p>Loading encrypted entries... Select a category on the left to access the database.</p>
        </div>
        <div id="blueBase"></div>
      </div>
    </div>
    <div id="dotFlicker"></div>
    <div id="cursor-dot"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const categoryBtns = document.querySelectorAll('.category-btn');
  const entryContent = document.getElementById('entryContent');
  const breadcrumbs = document.getElementById('breadcrumbs');
  const homeBtn = document.getElementById('homeBtn');
  const searchInput = document.getElementById('search');
  const flicker = document.getElementById('flicker');
  const distortion = document.getElementById('distortion');
  const screen = document.getElementById('screen');
  const cursorDot = document.getElementById('cursor-dot');
  const dotFlicker = document.getElementById('dotFlicker');

  let activeCategory = null;
  let activeSubFile = null;
  let isGM = false;

  // Example entries data; in real use, fetch JSONs instead
  const entriesData = [
    {
      id: 'yavin-4',
      category: 'planets',
      name: 'Yavin 4',
      description: 'Yavin 4 is a jungle-covered moon orbiting the gas giant Yavin in the Outer Rim. Its dense forests, tangled undergrowth, and towering Massassi temples provided natural concealment, making it the perfect location for the Rebel Alliance’s first major hidden base. The moon is alive with vibrant, untamed flora: massive ferns and vine-draped trees dominate the canopy, while luminescent fungi and orchids add pockets of color in the shadowed underbrush. The fauna is equally diverse and unpredictable, from skittering multi-legged insects to silent, camouflaged predators lurking in the misty jungles. Hidden pools and marshlands provide water sources, but also conceal swamp-dwelling creatures and crawling reptiles that challenge even experienced scouts. These jungles and valleys created a natural fortress, keeping Imperial eyes from discovering the fledgling Rebellion’s operations.\n\nFollowing the destruction of the Death Star, Yavin 4’s role as a Rebel base became untenable. With the Empire now aware of the moon’s significance, the Alliance evacuated personnel and critical resources, leaving only traces of the operations that had taken place there. The Massassi temples, once bustling with activity, now sit silent amidst the jungles, echoing the first great victory against Imperial tyranny.\n\nFor the Rebellion, Yavin 4 remains a symbol of hope and resilience. Though abandoned, the moon represents the courage of those who stood against overwhelming odds, and the daring that made the Alliance’s early victories possible. Scouts and historians note the ruins not only for their tactical significance but as a reminder of the sacrifices and ingenuity that continue to fuel the fight for freedom.',
      gmMode: true
    }
    // Add more entries here, or fetch from entries/<category>/ JSONs
  ];

  // GM Mode toggle with Ctrl+Shift+G
  document.addEventListener('keydown', (e) => {
    if(e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'g'){
      isGM = !isGM;
      console.log('GM Mode:', isGM ? 'ON' : 'OFF');
      renderEntries(entriesData);
    }
  });

  function renderEntries(data){
    entryContent.innerHTML = '';
    const filter = searchInput.value.toLowerCase();

    data.forEach(entry => {
      if(entry.category !== activeCategory && activeCategory) return;

      // Check unlock status
      const unlocked = entry.gmMode ? localStorage.getItem(entry.id) === "true" : true;
      if(!unlocked && !isGM) return;

      if(filter && !entry.name.toLowerCase().includes(filter)) return;

      const btn = document.createElement('button');
      btn.classList.add('category-btn');
      btn.textContent = entry.name;
      btn.style.color = unlocked ? "#33cfff" : "#ffff66"; // yellow if GM sees locked
      btn.addEventListener('click', () => {
        activeSubFile = entry;
        renderEntryDetail(entry);
      });

      // GM Unlock/Lock button
      if(isGM && entry.gmMode){
        const lockBtn = document.createElement('button');
        lockBtn.textContent = unlocked ? "Lock" : "Unlock";
        lockBtn.style.marginLeft = "8px";
        lockBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          if(localStorage.getItem(entry.id) === "true") localStorage.removeItem(entry.id);
          else localStorage.setItem(entry.id,"true");
          renderEntries(data);
        });
        btn.appendChild(lockBtn);
      }

      entryContent.appendChild(btn);
    });

    updateBreadcrumbs();
  }

  function renderEntryDetail(entry){
    entryContent.innerHTML = `<h1>${entry.name}</h1><p>${entry.description}</p>`;
    if(isGM && entry.gmMode){
      const unlockBtn = document.createElement('button');
      const unlocked = localStorage.getItem(entry.id) === "true";
      unlockBtn.textContent = unlocked ? "Lock" : "Unlock";
      unlockBtn.classList.add('category-btn');
      unlockBtn.style.marginTop = "10px";
      unlockBtn.addEventListener('click', () => {
        if(unlocked) localStorage.removeItem(entry.id);
        else localStorage.setItem(entry.id,"true");
        renderEntries(entriesData);
      });
      entryContent.appendChild(unlockBtn);
    }
  }

  function updateBreadcrumbs(){
    breadcrumbs.innerHTML = '';
    if(activeCategory){
      const catSpan = document.createElement('span');
      catSpan.textContent = activeCategory.charAt(0).toUpperCase() + activeCategory.slice(1);
      catSpan.style.cursor = 'pointer';
      catSpan.addEventListener('click', () => {
        activeSubFile = null;
        renderEntries(entriesData);
      });
      breadcrumbs.appendChild(catSpan);

      if(activeSubFile){
        const sep = document.createElement('span');
        sep.textContent = ' > ';
        breadcrumbs.appendChild(sep);

        const subSpan = document.createElement('span');
        subSpan.textContent = activeSubFile.name;
        breadcrumbs.appendChild(subSpan);
      }
    }
  }

  categoryBtns.forEach(btn => {
    if(btn.id === "homeBtn") return;
    btn.addEventListener('click', () => {
      categoryBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeCategory = btn.dataset.category;
      activeSubFile = null;
      renderEntries(entriesData);
    });
  });

  homeBtn.addEventListener('click', () => {
    activeCategory = null;
    activeSubFile = null;
    categoryBtns.forEach(b => b.classList.remove('active'));
    entryContent.innerHTML = `<h1>Rebel Alliance Field Codex</h1>
                              <p>Loading encrypted entries... Select a category on the left to access the database.</p>`;
    breadcrumbs.innerHTML = '';
  });

  searchInput.addEventListener('input', () => { renderEntries(entriesData); });

  // Flicker effect
  function randomFlicker() {
    if(Math.random() < 0.4){
      flicker.style.opacity = (0.1 + Math.random() * 0.3).toFixed(2);
      setTimeout(() => { flicker.style.opacity = 0; }, 50 + Math.random() * 150);
    }
  }
  setInterval(randomFlicker, 80);

  // Distortion effect
  function randomDistortion() {
    if(Math.random() < 0.05) {
      const xShift = (Math.random() * 8 - 4).toFixed(1);
      const yShift = (Math.random() * 8 - 4).toFixed(1);
      distortion.style.transform = `translate(${xShift}px, ${yShift}px)`;
      setTimeout(() => { distortion.style.transform = 'translate(0,0)'; }, 50 + Math.random() * 50);
    }
  }
  setInterval(randomDistortion, 100);

  // Cursor tracking
  screen.addEventListener('mousemove', e => {
    const rect = screen.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    cursorDot.style.left = x + 'px';
    cursorDot.style.top = y + 'px';
  });

  // Dot flicker
  function createRandomDot() {
    const dot = document.createElement('div');
    dot.classList.add('dot');
    dot.style.left = Math.random() * 100 + '%';
    dot.style.top = Math.random() * 100 + '%';
    dotFlicker.appendChild(dot);
    setTimeout(() => dot.remove(), 100 + Math.random()*200);
  }
  setInterval(() => { if(Math.random() < 0.2) createRandomDot(); }, 50);

  // Initial render
  renderEntries(entriesData);
});
</script>
</body>
</html>
